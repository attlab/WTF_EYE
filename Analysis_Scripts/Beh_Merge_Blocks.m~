%==========================================================================
%{
Beh_Merge_Blocks
Purpose: merge blocks
Author: Tom Bullock, UCSB Attention Lab
Date last modified: 10.04.18

TO DO:  fix rename script to ensure we don't overwrite

%}
%==========================================================================
clear 
close all

% which subject(s)
subjects=2;

% set dirs
rDir='/Users/tombullock/Documents/Psychology/WTF_EYE';
behDir=[rDir '/' 'Beh_Data'];
behDirProcessed=[rDir '/' 'Beh_Data_Processed'];

% rename raw files
Beh_Rename_Files(behDir)

for iSub=1:length(subjects)
    sjNum=subjects(iSub);
    
    clear allTrialData
    
    for iSession=1%:2
        
        % find CB order
        load([behDir '/' sprintf('sj%02d_se%02d_bl01_mc01_ec02.mat',sjNum,iSession)]);
        cbOrder=trialInfo(1).counterbalancingOrder;
        clear trialInfo
        
        for iCond=cbOrder
            
            clear allTrialData
            
            if      iCond==1; mc=1;ec=2;
            elseif  iCond==2; mc=1;ec=6;
            elseif  iCond==3; mc=2;ec=2;
            elseif  iCond==4; mc=2;ec=6;
            end
            
            clear demographicInfo
            
            for iBlock=1:4
                
                clear trialInfo 
                
                load([behDir '/' sprintf('sj%02d_se%02d_bl%02d_mc%02d_ec%02d.mat',sjNum,iSession,iBlock,mc,ec) ])
                
                if iBlock == 1
                    allTrialData(1:size(trialInfo,2)) = trialInfo;
                else
                    allTrialData(length(allTrialData)+1:length(allTrialData)+length(trialInfo))=trialInfo;
                end
                
            end
            
            % compile into master structure
            masterStruct(iSession,iCond).allTrialData=allTrialData;
            
        end
        
    end
    
    save([behDirProcessed '/' sprintf('sj%02d_allBeh.mat',sjNum) ],'masterStruct','demographicInfo','cbOrder')
    
end








% % % list files
% % d=dir(sprintf('sj%02d*.mat',sjNum));
% 
% % get counterbalancing order
% cbOrder=trialInfo(1).counterbalancingOrder;
% 
% % 
% 
% 
% 
% % this part merges the blocks
% for iSub = subjectNumber 
%     for iBlock = 1:15
%         load(sprintf('sj%02d_bl%02d_cond%02d_fr.mat',iSub,iBlock,condition));  % load file
%         % this part merges all blocks into one large mat
%         if iBlock == 1;
%             %allTrialData(1:size(dataMat,1),:) = dataMat;
%             allTrialData(1:size(trialInfo,2)) = trialInfo;
%         else
%             %allTrialData((size(allTrialData,1)+1:size(allTrialData,1)+size(dataMat,1)),:) = dataMat;
%             allTrialData(length(allTrialData)+1:length(allTrialData)+length(trialInfo))=trialInfo; 
%         end  
%     end
%     % save stuff
%     save(['/home/bullock/Foster_WM/TRIAL_DATA/MERGED_DATA' '/' sprintf('sj%d%02d_all_beh.mat',iSub,condition)],'allTrialData');
% end
% 
